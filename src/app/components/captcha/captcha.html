<div class="captcha-container">
  <div class="captcha-content">
    <h2>Captcha Challenge</h2>
    <p class="instruction">Complete the challenges below to prove you're human</p>
    
    <div class="challenge-info">
      <p>Stage: <strong>{{ currentStage }} / {{ totalStages }}</strong></p>
    </div>

    <div class="challenge-area" *ngIf="currentChallenge">
      <h3 class="challenge-question">{{ currentChallenge.question }}</h3>
      
      <!-- Image Selection Challenge -->
      <div *ngIf="currentChallenge.type === 'select-multiple'" class="image-grid">
        <div 
          *ngFor="let image of currentChallenge.images"
          class="image-item"
          [class.selected]="isImageSelected(image.id)"
          (click)="toggleImageSelection(image.id)"
        >
          <div class="image-emoji">{{ image.emoji }}</div>
          <div class="image-label">{{ image.label }}</div>
          <div class="selection-indicator" *ngIf="isImageSelected(image.id)">✓</div>
        </div>
      </div>

      <!-- Math Challenge -->
      <div *ngIf="currentChallenge.type === 'math'" class="math-challenge">
        <div class="math-problem">{{ currentChallenge.mathProblem }}</div>
        <input 
          type="number" 
          [(ngModel)]="userInput" 
          placeholder="Enter your answer"
          class="math-input"
          (keyup.enter)="submitAnswer()"
        />
      </div>

      <!-- Text Input Challenge -->
      <div *ngIf="currentChallenge.type === 'text-input'" class="text-challenge">
        <div class="text-prompt">{{ currentChallenge.textPrompt }}</div>
        <input 
          type="text" 
          [(ngModel)]="userInput" 
          placeholder="Type the word above"
          class="text-input"
          (keyup.enter)="submitAnswer()"
        />
      </div>

      <div class="feedback-message" *ngIf="showFeedback">
        <div class="feedback-correct" *ngIf="isCorrect">
          ✓ Correct! Moving to next challenge...
        </div>
        <div class="feedback-incorrect" *ngIf="!isCorrect">
          ✗ Incorrect. Please try again.
          <button class="btn-retry" (click)="resetFeedback()">Retry</button>
        </div>
      </div>

      <div class="submit-section" *ngIf="!showFeedback">
        <p class="selection-count" *ngIf="currentChallenge.type === 'select-multiple'">
          Selected: {{ selectedImages.size }} image(s)
        </p>
        <button class="btn-submit" (click)="submitAnswer()">
          {{ currentChallenge.type === 'select-multiple' ? 'Verify Selection' : 'Submit Answer' }}
        </button>
      </div>
    </div>

    <div class="navigation-buttons">
      <button class="btn-secondary" (click)="goBack()">Back to Home</button>
      <button *ngIf="canGoBack()" class="btn-secondary" (click)="previousStage()">Previous Stage</button>
    </div>
  </div>
</div>
